<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Q3 2025 Performance</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at center, #0a0f1f, #000); /* main bg */
      font-family: 'Inter', sans-serif;
      color: #00facc;
      overflow: hidden;
    }

    #chart-container {
      width: 65%;
      height: 75vh;
      max-width: 800px;
      padding: 20px;
      border: 2px solid #00facc;
      border-radius: 24px;
      box-shadow: 0 0 15px rgba(0,250,204,0.4), inset 0 0 8px rgba(0,250,204,0.1);
      background: transparent;
      position: relative;
      transition: transform 0.2s ease;
      backdrop-filter: blur(10px);
    }

    #chart-container:hover {
      transform: scale(1.02);
      box-shadow: 0 0 20px rgba(0,250,204,0.6), inset 0 0 12px rgba(0,250,204,0.2);
    }

    canvas {
      background: transparent !important;
    }

    /* Cursor animation glow */
    body {
      cursor: none;
    }

    .cursor {
      position: fixed;
      top: 0;
      left: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(0, 250, 204, 0.8);
      box-shadow: 0 0 15px rgba(0, 250, 204, 0.9), 0 0 25px rgba(0, 250, 204, 0.6);
      pointer-events: none;
      transform: translate(-50%, -50%);
      transition: width 0.15s ease, height 0.15s ease, background 0.2s ease;
      z-index: 9999;
    }

    .cursor.active {
      width: 40px;
      height: 40px;
      background: rgba(0, 250, 204, 0.4);
    }
  </style>
</head>
<body>
  <div id="chart-container">
    <canvas id="myChart"></canvas>
  </div>

  <!-- Neon cursor -->
  <div class="cursor" id="cursor"></div>

  <script>
    const urls = [
      'https://anaheim-swedish-metro-subscriptions.trycloudflare.com/Q3results',
      'https://extra-backends.onrender.com/Q3results'
    ];
    
    function showError(message) {
      console.error('Error:', message);
    }

    function hideError() {
      // Clear any previous errors
    }

    // Function to fetch Q3 results from API
    async function fetchQ3Results(urlIndex = 0) {
      try {
        hideError();
        
        const response = await fetch(urls[urlIndex], {
          headers: {
            'Accept': 'application/json',
            'ngrok-skip-browser-warning': 'true'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        console.log('Q3 Results:', data);
        
        // Update the chart with fetched data
        updateChartWithData(data);
        
      } catch (error) {
        console.error(`Error with ${urls[urlIndex]}:`, error);
        if (urlIndex + 1 < urls.length) {
          console.log("Switching to alternate URL...");
          await fetchQ3Results(urlIndex + 1);
        } else {
          console.error('All URLs failed, using fallback data');
          // Fallback to static data if all APIs fail
          const fallbackData = {
            btcusdt: 0,
            ibit: 0,
            sturmcapy: 0
          };
          updateChartWithData(fallbackData);
        }
      }
    }

    // Function to update chart with fetched data
    function updateChartWithData(data) {
      // Extract values from the data object
      const btcusdtValue = data.btcusdt || 0;
      const ibitValue = data.ibit || 0;
      const sturmcapyValue = data.sturmcapy || 0;
      
      // Animate bars and labels progressively for smooth effect
      setTimeout(() => {
        chart.data.datasets[0].data[0] = btcusdtValue;
        chart.update('active');
        // Animate BTCUSDT label
        animateLabel(0, "BTCUSDT:BINANCE", "#FFD700");
      }, 0);
      
      setTimeout(() => {
        chart.data.datasets[0].data[1] = ibitValue;
        chart.update('active');
        // Animate IBIT label
        animateLabel(1, "BLACKROCK's IBIT", "#ff5733");
      }, 400);
      
      setTimeout(() => {
        chart.data.datasets[0].data[2] = sturmcapyValue;
        chart.update('active');
        // Animate SturmCapy label
        animateLabel(2, "ENIGMACAPITAL's STURMCAPY", "#00facc");
      }, 800);
    }

    // Function to animate individual labels
    function animateLabel(index, text, color) {
      const ctx = chart.ctx;
      const xAxis = chart.scales.x;
      const tick = xAxis.ticks[index];
      
      if (tick) {
        // Animate label opacity and position
        let opacity = 0;
        let yOffset = 20;
        const targetY = tick.y;
        
        const animate = () => {
          opacity += 0.05;
          yOffset -= 1;
          
          ctx.save();
          ctx.globalAlpha = opacity;
          ctx.fillStyle = color;
          ctx.font = 'bold 12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText(text, tick.x, targetY + yOffset);
          ctx.restore();
          
          if (opacity < 1 && yOffset > 0) {
            requestAnimationFrame(animate);
          }
        };
        
        animate();
      }
    }

    // Chart data - start with 0 values, will be updated by API
    const ctx = document.getElementById('myChart').getContext('2d');
    const data = {
      labels: ["BTCUSDT:BINANCE", "BLACKROCK's IBIT", "ENIGMACAPITAL's STURMCAPY"],
      datasets: [{
        label: "Return (%)",
        data: [0, 0, 0], // Start with 0, will be updated by API
        backgroundColor: "transparent", // hollow
        borderWidth: 4,
        borderColor: ["#FFD700", "#ff5733", "#00facc"],
        barThickness: 40
      }]
    };

    const options = {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
        duration: 2000,
        easing: "easeOutExpo"
      },
      transitions: {
        active: {
          animation: {
            duration: 1500,
            easing: 'easeOutQuart'
          }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: "rgba(0, 0, 0, 0.85)",
          borderColor: "#00facc",
          borderWidth: 1,
          titleColor: "#00facc",
          bodyColor: "#fff",
          cornerRadius: 8,
          boxPadding: 6,
        },
        title: {
          display: true,
          text: "Q3 2025 Performance",
          color: "#00facc",
          font: { size: 22, weight: "bold" },
          padding: { bottom: 20 }
        }
      },
      scales: {
        x: {
          grid: { color: "rgba(0,250,204,0.2)" },
          ticks: { 
            color: function(context) {
              const colors = ["#FFD700", "#ff5733", "#00facc"];
              return colors[context.index] || "#00facc";
            },
            font: { weight: "bold", size: 12 }
          },
          animation: {
            duration: 2000,
            easing: 'easeOutExpo'
          }
        },
        y: {
          grid: { color: "rgba(0,250,204,0.15)" },
          ticks: { color: "#00facc" },
          animation: {
            duration: 2000,
            easing: 'easeOutExpo'
          }
        }
      }
    };

    // Create chart and store reference
    const chart = new Chart(ctx, {
      type: "bar",
      data: data,
      options: options
    });

    // Fetch data when page loads
    fetchQ3Results();

    // Neon cursor script
    const cursor = document.getElementById("cursor");
    document.addEventListener("mousemove", e => {
      cursor.style.top = e.clientY + "px";
      cursor.style.left = e.clientX + "px";
    });
    document.addEventListener("mousedown", () => cursor.classList.add("active"));
    document.addEventListener("mouseup", () => cursor.classList.remove("active"));
  </script>
</body>
</html>
